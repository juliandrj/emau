<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<link rel="stylesheet" href="css/emau.css">
<title>cargando...</title>
</head>
<body id="page-top">
	<div id="loading" class="modal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-body">
					<h3>cargando...</h3>
					<div class="progress">
						<div class="progress-bar progress-bar-striped active"
							role="progressbar" aria-valuenow="100" aria-valuemin="0"
							aria-valuemax="100" style="width: 100%">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_ppal">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<!-- ko if: doc -->
				<a class="navbar-brand page-scroll" href="#page-top" data-bind="text: doc().titulo"></a>
				<!-- /ko -->
			</div>
			<div class="collapse navbar-collapse" id="menu_ppal">
				<!-- ko if: doc -->
				<ul class="nav navbar-nav navbar-right" data-bind="foreach: doc().modulos">
					<li><a class="page-scroll" data-bind="text: $data.titulo, attr: {href: '#' + $data.id}"></a></li>
				</ul>
				<!-- /ko -->
			</div>
		</div>
	</nav>
	<header id="portada" class="pin-panel">
		<div class="header-content img-rounded">
			<div class="header-content-inner">
				<!-- ko if: doc -->
				<img src="backend/images/logo.png" data-bind="attr: {alt: doc().titulo}">
				<h1 data-bind="text: doc().descripcion"></h1>
				<!-- /ko -->
			</div>
		</div>
	</header>
	<!-- ko if: doc -->
		<div id="contenido" class="pin-panel" data-bind="foreach: doc().modulos">
			<!-- ko if: $data.contenido.contenido.length == 1 -->
				<!-- ko with: $data.contenido.contenido[0] -->
					<section class="modulo pantalla singular" data-bind="attr: {id: $parent.id}, style: {'background-image': 'url(backend/' + imgs.image_intro + ')'}">
						<article class="caja img-rounded">
							<h3 data-bind="text: titulo"></h3>
							<div data-bind="html: introtext"></div>
						</article>
						<h2 class="slideno" data-bind="text: $parent.titulo"></h2>
					</section>
				<!-- /ko -->
			<!-- /ko -->
			<!-- ko if: $data.contenido.contenido.length >= 2 -->
				<div class="modulo" data-bind="attr: {id: $data.id}">
					<!-- ko foreach: $data.contenido.contenido -->
						<section class="pantalla plural" data-bind="attr: {id: ($parent.id + '_' + $index())}, style: {'background-image': 'url(backend/' + imgs.image_intro + ')'}">
							<article class="caja img-rounded">
								<div class="row">
									<div class="col-sm-10">
										<h3 data-bind="text: titulo"></h3>
									</div>
									<div class="col-sm-2">
										<button data-bind="attr: {'data-target': '#' + $parent.id + '_colap_' + $index(), 'aria-controls': $parent.id + '_colap_' + $index()}" class="btn" type="button" data-toggle="collapse" aria-expanded="false">
											<span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
										</button>
									</div>
								</div>
								<div data-bind="attr: {id: $parent.id + '_colap_' + $index()}" class="collapse in">
									<div data-bind="html: introtext"></div>
								</div>
							</article>
						</section>
					<!-- /ko -->
					<h2 class="slideno" data-bind="text: $data.titulo"></h2>
				</div>
			<!-- /ko -->
		</div>
	<!-- /ko -->
	<section>
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur tempus efficitur volutpat. Aliquam erat volutpat. Donec blandit finibus quam et scelerisque. Nullam tempor urna non eros tempus venenatis. Aliquam erat volutpat. Maecenas a sapien quis turpis convallis porta eu vel urna. Donec feugiat lorem non felis facilisis consequat. Pellentesque non tortor non arcu elementum hendrerit ac at orci. Sed metus ante, fringilla id dictum rhoncus, hendrerit quis tortor. Vestibulum volutpat risus sed tristique elementum. Quisque sit amet quam nibh. Integer venenatis sapien eu orci lacinia tincidunt. Nam elementum bibendum ante, sit amet suscipit ipsum placerat id. Cras suscipit tortor a mauris auctor malesuada.</p>
	</section>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>
	<script type="text/javascript" src="js/jquery.easing.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/plugins/animation.gsap.js"></script>
	<script type="text/javascript">
		var EmauVM = function() {
			var self = this;
			self.doc = ko.observable();
		};
		var emau = new EmauVM();
		$(document).ready(function() {
			$('#loading').modal();
			var hbar = $('#mainNav').height();
			$.ajax({
				url : 'backend/',
				type : 'get',
				dataType : 'json',
				success : function(data) {
					emau.doc(data);
					document.title = data.titulo;
					$('a.page-scroll').bind('click', function(event) {
						var $anchor = $(this);
						$('html, body').stop().animate({
							scrollTop : ($($anchor.attr('href')).offset().top)
						}, 1250, 'easeInOutExpo');
						event.preventDefault();
					});
					$('body').scrollspy({
						target : '.navbar-fixed-top',
						offset : 0
					});
					$('.navbar-collapse ul li a').click(function() {
						$('.navbar-toggle:visible').click();
					});
					$('#mainNav').affix({
						offset : {
							top : 100
						}
					});
					var controller = new ScrollMagic.Controller();
					var wipeAnimation = new TimelineMax();
					var i = 1;
					var first = true;
					$('.modulo').each(function () {
						if (!first) {
							if ($(this).hasClass('pantalla')) {
								wipeAnimation.fromTo(this, 1, {y: "100%"}, {y: "0%", ease: Linear.easeNone});
								wipeAnimation.fromTo($('h2.slideno', this), 1, {y: "-1000%"}, {y: "0%", ease: Linear.easeNone}, '-=1');
							} else {
								var n = 0;
								$('section.pantalla', this).each(function () {
									i *= -1;
									n++;
									wipeAnimation.fromTo(this, 1, {x: (i * 100) + "%"}, {x: "0%", ease: Linear.easeNone});
								});
								wipeAnimation.fromTo($('h2.slideno', this), n, {y: "-1000%"}, {y: "0%", ease: Linear.easeNone}, '-=' + n);
							}
						} else{
							first = false;
						}
					});
					new ScrollMagic.Scene({
				         triggerElement: "#contenido",
				         triggerHook: "onLeave",
				         duration: "300%"
				     })
				     .setPin("#contenido")
				     .setTween(wipeAnimation)
				     .addTo(controller);
					$('#loading').modal('hide');
				},
				error : function(jqXHR, textStatus, errorThrown) {
					console.log(errorThrown);
					$('#loading').modal('hide');
				}
			});
			ko.applyBindings(emau);
		});
	</script>
</body>
</html>